<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facility Booking Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../css/nav.css">
<style>
:root{--primary:#007bff;--secondary:#6c757d;--success:#28a745;--danger:#dc3545;--warning:#ffc107;--info:#17a2b8;--light-gray:#f8f9fa;--gray:#6c757d;--dark:#343a40;--border-radius:8px;--shadow:0 2px 10px rgba(0,0,0,0.1);--transition:all 0.3s ease}
.section-title{position:relative;padding-bottom:1rem;margin-bottom:1.5rem;border-bottom:2px solid var(--light-gray)}
.section-title::after{content:"";position:absolute;bottom:-2px;left:0;width:120px;height:3px;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:3px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}
.stat-card{background:white;border-radius:var(--border-radius);padding:1.5rem;box-shadow:var(--shadow);border-left:6px solid;transition:var(--transition)}
.stat-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,0.15)}
.card-value{font-size:2.5rem;font-weight:700;margin:0.5rem 0}
.card-label{color:var(--gray);font-size:1.1rem}
.bookings-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;margin-top:1.5rem}
.booking-card{background:white;border-radius:var(--border-radius);box-shadow:var(--shadow);padding:1.5rem;transition:var(--transition);border-left:4px solid var(--primary)}
.booking-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,0.15)}
.booking-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid var(--light-gray)}
.booking-id{font-weight:600;color:var(--primary);font-size:0.9rem}
.booking-details{margin-bottom:1rem}
.booking-detail{display:flex;margin-bottom:0.75rem}
.detail-label{font-weight:600;color:var(--dark);min-width:100px}
.detail-value{color:var(--gray)}
.booking-actions{display:flex;gap:0.75rem;margin-top:1rem}
.action-btn{padding:0.5rem 1rem;border-radius:5px;font-size:0.9rem;transition:var(--transition);display:inline-flex;align-items:center;gap:0.5rem;border:none;cursor:pointer;font-weight:500}
.action-btn.view{background-color:var(--info);color:white}
.action-btn.cancel{background-color:var(--danger);color:white}
.action-btn:hover{opacity:0.9;transform:translateY(-2px);box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.status-badge{display:inline-flex;align-items:center;padding:0.35rem 0.75rem;border-radius:20px;font-size:0.8rem;font-weight:600;text-transform:capitalize;letter-spacing:0.3px;box-shadow:inset 0 0 0 1px rgba(0,0,0,0.05)}
.status-badge::before{content:"";display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px;background:currentColor;opacity:0.7}
.status-Pending{background-color:rgba(234,179,8,0.1);color:#b45309}
.status-Approved{background-color:rgba(16,185,129,0.1);color:#047857}
.status-Rejected{background-color:rgba(239,68,68,0.1);color:#b91c1c}
.status-Cancelled{background-color:rgba(107,114,128,0.1);color:#4b5563}
.status-Completed{background-color:rgba(6,182,212,0.1);color:#0e7490}
.popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:2000;justify-content:center;align-items:center}
.popup-content{background:white;padding:2rem;border-radius:var(--border-radius);box-shadow:0 10px 30px rgba(0,0,0,0.2);width:90%;max-width:600px;max-height:90vh;overflow-y:auto;position:relative;animation:popupFadeIn 0.3s ease-out}
@keyframes popupFadeIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
.close-btn{position:absolute;top:1rem;right:1rem;font-size:1.75rem;color:var(--danger);cursor:pointer;transition:var(--transition);background:none;border:none;width:2.5rem;height:2.5rem;display:flex;align-items:center;justify-content:center;border-radius:50%}
.close-btn:hover{background-color:rgba(220,53,69,0.1);transform:rotate(90deg)}
.form-title{margin:0 0 1.5rem 0;color:var(--dark);font-size:1.5rem;font-weight:600;letter-spacing:-0.5px;text-align:center;position:relative;padding-bottom:1rem;border-bottom:2px solid var(--light-gray)}
.form-title::after{content:"";position:absolute;bottom:-2px;left:50%;transform:translateX(-50%);width:60px;height:3px;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:3px}
.details-container{display:flex;flex-direction:column;gap:1.2rem}
.detail-group{display:grid;grid-template-columns:140px 1fr;gap:1rem;align-items:start;padding:0.75rem;border-radius:8px;background:rgba(248,249,250,0.5);border-left:3px solid var(--primary);transition:var(--transition)}
.detail-group:hover{background:rgba(248,249,250,0.8);transform:translateX(5px)}
.detail-group .detail-label{font-weight:600;color:var(--dark);font-size:0.9rem;min-width:140px}
.detail-group .detail-value{color:var(--gray);font-size:0.95rem;line-height:1.5;word-break:break-word}
.detail-section{margin-top:2rem;padding:1.5rem;background:linear-gradient(135deg,rgba(248,249,250,0.8),rgba(255,255,255,0.9));border-radius:var(--border-radius);border-left:4px solid var(--primary);box-shadow:0 2px 10px rgba(0,0,0,0.05)}
.detail-section h5{margin:0 0 1rem 0;color:var(--dark);font-size:1.1rem;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;display:flex;align-items:center;gap:0.5rem}
.detail-section h5::before{content:"";width:20px;height:3px;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:3px}
#cancellation-section{border-left-color:var(--danger)}
#cancellation-section h5::before{background:linear-gradient(90deg,var(--danger),#ff6b6b)}
#feedback-section{border-left-color:var(--success)}
#feedback-section h5::before{background:linear-gradient(90deg,var(--success),#4caf50)}
#bookingForm{max-width:500px;margin:0 auto;padding:1.5rem;background-color:rgba(248,249,250,0.5);border-radius:var(--border-radius);box-shadow:inset 0 0 0 1px rgba(0,0,0,0.05)}
.form-group{margin-bottom:1.5rem;display:flex;flex-direction:column}
.form-group label{margin-bottom:0.5rem;font-weight:600;color:var(--dark);font-size:0.9rem}
.form-group input,.form-group select,.form-group textarea{padding:0.75rem;border:1px solid var(--light-gray);border-radius:8px;font-size:1rem;transition:var(--transition);background:white}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 3px rgba(0,123,255,0.1)}
.form-button{display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.75rem 1.5rem;background-color:var(--primary);color:white;border:none;font-size:1rem;border-radius:8px;cursor:pointer;transition:var(--transition);width:100%;font-weight:600}
.form-button:hover{background-color:#0056b3;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,123,255,0.3)}
.popup-content::-webkit-scrollbar{width:6px}
.popup-content::-webkit-scrollbar-track{background:rgba(0,0,0,0.03);border-radius:3px}
.popup-content::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.15);border-radius:3px}
.popup-content::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,0.25)}

/* Enhanced Time Slots Styling */
.time-slots-container {
  margin: 20px 0;
  background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
  border-radius: 12px;
  padding: 24px;
  border: 2px solid #e3f2fd;
  box-shadow: 0 4px 20px rgba(0, 123, 255, 0.08);
  position: relative;
  overflow: hidden;
}

.time-slots-container::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #007bff, #0056b3, #007bff);
  background-size: 200% 100%;
  animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% { background-position: 200% 0; }
  50% { background-position: -200% 0; }
}

.time-slots-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e8f4f8;
}

.time-slots-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #1e40af;
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0;
}

.time-slots-title i {
  font-size: 1.2rem;
  color: #007bff;
}

.time-period-info {
  background: rgba(0, 123, 255, 0.1);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  color: #0056b3;
  font-weight: 600;
  border: 1px solid rgba(0, 123, 255, 0.2);
}

.time-slots-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
}

.time-slot {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px 8px;
  background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
  border: 2px solid #e1e8f0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 0.9rem;
  font-weight: 600;
  text-align: center;
  user-select: none;
  min-height: 52px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  overflow: hidden;
}

.time-slot::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
  transition: left 0.5s ease;
}

.time-slot:hover::before {
  left: 100%;
}

.time-slot:hover {
  border-color: #007bff;
  background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
  color: #0056b3;
}

.time-slot.selected {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
  border-color: #004085;
  color: white;
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
  position: relative;
}

.time-slot.selected::after {
  content: "✓";
  position: absolute;
  top: -8px;
  right: -8px;
  background: #28a745;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: bold;
  border: 2px solid white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.time-slot.selected:hover {
  background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 10px 30px rgba(0, 123, 255, 0.5);
}

.time-slot.disabled {
  background: linear-gradient(135deg, #f5f5f5 0%, #e9ecef 100%);
  border-color: #ced4da;
  color: #6c757d;
  cursor: not-allowed;
  opacity: 0.6;
  position: relative;
}

.time-slot.disabled::after {
  content: "✕";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #dc3545;
  font-size: 1.2rem;
  font-weight: bold;
}

.time-slot.disabled:hover {
  transform: none;
  box-shadow: none;
  border-color: #ced4da;
  background: linear-gradient(135deg, #f5f5f5 0%, #e9ecef 100%);
}

.time-slot input[type="checkbox"] {
  display: none;
}

/* Range Selection Styles */
.time-slot.in-range {
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  border-color: #90caf9;
  color: #1565c0;
  transform: translateY(-1px);
}

.time-slot.range-start {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
  border-color: #004085;
  color: white;
  position: relative;
}

.time-slot.range-end {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
  border-color: #004085;
  color: white;
}

.time-slot.range-start::before {
  content: "START";
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.6rem;
  font-weight: bold;
  color: #007bff;
  background: white;
  padding: 2px 8px;
  border-radius: 8px;
  border: 1px solid #007bff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  z-index: 10;
}

.time-slot.range-end::after {
  content: "END";
  position: absolute;
  bottom: -12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.6rem;
  font-weight: bold;
  color: #007bff;
  background: white;
  padding: 2px 8px;
  border-radius: 8px;
  border: 1px solid #007bff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  z-index: 10;
}

.booking-instructions {
  background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
  border: 2px solid #c3e6c3;
  border-radius: 12px;
  padding: 16px 20px;
  margin-bottom: 20px;
  font-size: 0.9rem;
  color: #2d5a2d;
  position: relative;
  overflow: hidden;
}

.booking-instructions::before {
  content: "💡";
  position: absolute;
  top: 16px;
  left: 16px;
  font-size: 1.2rem;
}

.booking-instructions h4 {
  margin: 0 0 10px 30px;
  color: #1e5e1e;
  font-size: 1rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
}

.booking-instructions ul {
  margin: 10px 0 0 50px;
  padding: 0;
  list-style: none;
}

.booking-instructions li {
  margin-bottom: 6px;
  position: relative;
  padding-left: 16px;
}

.booking-instructions li::before {
  content: "→";
  position: absolute;
  left: 0;
  color: #28a745;
  font-weight: bold;
}

.selected-time-display {
  background: linear-gradient(135deg, #fff8f0 0%, #fef7ed 100%);
  border: 2px solid #fed7aa;
  border-radius: 12px;
  padding: 16px 20px;
  margin-top: 16px;
  font-size: 0.95rem;
  position: relative;
  min-height: 60px;
  display: flex;
  align-items: center;
  box-shadow: 0 4px 12px rgba(249, 115, 22, 0.1);
}

.selected-time-display::before {
  content: "⏰";
  font-size: 1.5rem;
  margin-right: 12px;
}

.selected-time-display strong {
  color: #ea580c;
  font-weight: 700;
  margin-right: 8px;
}

.selected-time-display .no-selection {
  color: #9ca3af;
  font-style: italic;
  font-weight: 500;
}

.selected-time-display .time-range {
  color: #1f2937;
  font-weight: 600;
  background: rgba(249, 115, 22, 0.1);
  padding: 4px 12px;
  border-radius: 20px;
  border: 1px solid rgba(249, 115, 22, 0.2);
}

@media (max-width:768px){
.bodyContainer{padding:1rem}
.contentCon{padding:1.5rem}
.bookings-grid{grid-template-columns:1fr}
.booking-actions{flex-direction:column}
.action-btn{width:100%;justify-content:center}
.detail-group{grid-template-columns:1fr;gap:0.5rem}
.detail-group .detail-label{min-width:auto;margin-bottom:0.25rem;color:var(--primary);font-size:0.85rem}
.detail-group .detail-value{font-size:0.9rem}
.popup-content{padding:1.5rem}
.detail-section{padding:1rem}
.section-title::after{width:80px}
.time-slots-grid{grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px}
.time-slot{padding:12px 6px;font-size:0.85rem;min-height:48px}
.time-slots-container{padding:20px 16px}
}
@media (max-width:600px){
.time-slots-grid{grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:8px}
.time-slot{padding:10px 4px;font-size:0.8rem;min-height:44px}
.popup-content{width:95%;padding:20px;margin:20px}
.time-slots-container{padding:16px 12px}
.time-slots-header{flex-direction:column;gap:8px;text-align:center}
}
@media (max-width:480px){
.stats-grid{grid-template-columns:1fr}
.card-value{font-size:2rem}
.popup-content{width:95%;padding:1rem}
.form-title{font-size:1.25rem}
.detail-group{padding:0.5rem}
.detail-section{margin-top:1rem;padding:0.75rem}
.detail-section h5{font-size:1rem}
.bookings-grid{grid-template-columns:1fr;gap:1rem}
.booking-card{padding:1rem}
.time-slots-grid{grid-template-columns:repeat(auto-fit,minmax(80px,1fr))}
.time-slot{padding:8px 4px;font-size:0.75rem;min-height:40px}
}
@media (max-width:360px){
.popup-content{width:98%;padding:0.75rem}
.detail-group{padding:0.5rem;gap:0.25rem}
.close-btn{width:2rem;height:2rem;font-size:1.5rem}
.time-slots-container{padding:12px 8px}
.time-slot{padding:6px 2px;font-size:0.7rem;min-height:36px}
}
</style>
</head>
<body>
<%- include('../../partials/residentNav.ejs') %>
<div class="bodyContainer">
<div class="adCon d-flex justify-content-center align-items-center">
<div class="advertisement" id="ad-slider">
<% if (locals.ads && ads.length > 0) { %><% ads.forEach(ad => { %>
<img src="http://localhost:3000/<%= ad.imagePath.replace(/\\/g, '/') %>" class="ad-slide" alt="Ad" height="100px" width="200px"><% }) %><% } else { %>
<p class="ad-text">Advertisement</p><% } %>
</div>
</div>
<div class="contentCon">
<div class="d-flex justify-content-between align-items-center mb-4">
<h4 class="section-title">Common Space Bookings</h4>
<button id="bookFacilityBtn" class="btn btn-primary"><i class="bi bi-plus-lg me-2"></i>Book a Facility</button>
</div>
<div class="stats-grid mb-4">
<div class="stat-card" style="border-left-color: var(--success)">
<p class="card-label">Total Bookings (this month)</p>
<h2 class="card-value text-success">5</h2>
</div>
<div class="stat-card" style="border-left-color: var(--warning)">
<p class="card-label">Pending Bookings</p>
<h2 class="card-value text-warning">10</h2>
</div>
<div class="stat-card" style="border-left-color: var(--primary)">
<p class="card-label">Total Facilities</p>
<h2 class="card-value text-primary">5</h2>
</div>
</div>
<div>
<h4 class="table-title">Recent Bookings</h4>
<div class="bookings-grid">
<% if (locals.bookings) { %><% bookings.forEach(b=> { %>
<div class="booking-card <%= b.status %>">
<div class="booking-card-header">
<span class="booking-id">#<%= b._id.toString().slice(-6) %></span>
<span class="status-badge status-<%= b.status %>"><%= b.status %></span>
</div>
<div class="booking-details">
<div class="booking-detail">
<span class="detail-label">Facility:</span>
<span class="detail-value"><%= b.name %></span>
</div>
<div class="booking-detail">
<span class="detail-label">Date:</span>
<span class="detail-value"><%= b.Date %></span>
</div>
<div class="booking-detail">
<span class="detail-label">Time:</span>
<span class="detail-value"><%= b.from %> - <%= b.to %></span>
</div>
<% if (b.purpose) { %>
<div class="booking-detail">
<span class="detail-label">Purpose:</span>
<span class="detail-value"><%= b.purpose %></span>
</div>
<% } %>
</div>
<div class="booking-actions">
<button class="action-btn view" data-id="<%= b._id %>"><i class="bi bi-eye"></i> View Details</button>
<% if (b.status==="Pending" ) { %>
<button class="action-btn cancel" data-id="<%= b._id %>"><i class="bi bi-x-circle"></i> Cancel</button>
<% } %>
</div>
</div>
<% }) %><% } else { %>
<div class="no-bookings"><p>No bookings found</p></div>
<% } %>
</div>
</div>
</div>
</div>
<% if (bookings && bookings.length > 0) { %>
  <% bookings.forEach(function(booking) { %>
    <div class="booking-card">
      <div class="booking-header">
        <h4><%= booking.spaceName || booking.name %></h4>
        <span class="status-badge status-<%= booking.status.toLowerCase() %>">
          <%= booking.status.charAt(0).toUpperCase() + booking.status.slice(1) %>
        </span>
      </div>
      
      <div class="booking-details">
        <div class="detail-row">
          <i class="bi bi-calendar"></i>
          <span><%= new Date(booking.date || booking.Date).toLocaleDateString() %></span>
        </div>
        
        <div class="detail-row">
          <i class="bi bi-clock"></i>
          <span><%= booking.startTime || booking.from %> - <%= booking.endTime || booking.to %></span>
        </div>
        
        <% if (booking.description) { %>
        <div class="detail-row">
          <i class="bi bi-card-text"></i>
          <span><%= booking.description %></span>
        </div>
        <% } %>
        
        <div class="detail-row">
          <i class="bi bi-clock-history"></i>
          <span>Booked on <%= new Date(booking.createdAt).toLocaleDateString() %></span>
        </div>
      </div>
      
      <div class="booking-actions">
        <button class="action-btn view" data-id="<%= booking._id %>">
          <i class="bi bi-eye"></i> View Details
        </button>
        
        <% if (booking.status === 'pending' || booking.status === 'approved') { %>
        <button class="action-btn cancel" data-id="<%= booking._id %>">
          <i class="bi bi-x-circle"></i> Cancel
        </button>
        <% } %>
      </div>
    </div>
  <% }); %>
<% } else { %>
  <div class="no-bookings">
    <i class="bi bi-calendar-x"></i>
    <h3>No Bookings Found</h3>
    <p>You haven't made any bookings yet. Click "Book Facility" to get started!</p>
  </div>
<% } %>

<!-- Booking Form Modal -->
<div id="bookingFormPopup" class="popup" style="display: none;">
  <div class="popup-content">
    <div class="popup-header">
      <h3>Book Common Space</h3>
      <button type="button" class="close-btn" onclick="closeForm('booking')">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <form id="bookingForm" action="/resident/commonSpace" method="POST">
      <div class="form-group">
        <label for="facility">Select Facility *</label>
        <select id="facility" name="facility" required onchange="handleFacilityChange()">
          <option value="">Choose a facility...</option>
          <option value="guest">Guest Suite</option>
          <option value="banquet">Banquet Hall</option>
          <option value="pool">Swimming Pool</option>
          <option value="gym">Gym</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="bookingDate">Select Date *</label>
        <input type="date" id="bookingDate" name="date" required onchange="handleDateChange()">
      </div>
      
      <!-- Enhanced Time slots section -->
      <div class="form-group">
        <label>Select Time Slots *</label>
        <div class="booking-instructions">
         
          <ul>
            <li>You can select multiple consecutive slots for longer bookings</li>
          </ul>
        </div>
        
        <div class="time-slots-container" id="timeSlotsContainer">
          <div class="time-slots-header">
            <h4 class="time-slots-title">
              <i class="bi bi-clock"></i>
              Available Time Slots
            </h4>
            <div class="time-period-info">6:00 AM - 10:00 PM</div>
          </div>
          
          <div class="time-slots-grid">
            <% for (let hour = 6; hour <= 22; hour++) { %>
              <% 
                const timeStr = String(hour).padStart(2, '0') + ':00';
                const displayTime = hour > 12 ? (hour - 12) + ':00 PM' : (hour === 12 ? '12:00 PM' : hour + ':00 AM');
              %>
              <div class="time-slot" data-time="<%= timeStr %>">
                <input type="checkbox" name="timeSlots" value="<%= timeStr %>" id="slot_<%= hour %>">
                <label for="slot_<%= hour %>"><%= displayTime %></label>
              </div>
            <% } %>
          </div>
          
          <div class="selected-time-display">
            <strong>Selected Time: </strong>
            <span id="selectedTimeText" class="no-selection">No time slots selected</span>
          </div>
        </div>
      </div>
      
      <!-- Updated hidden inputs with correct names -->
      <input type="hidden" id="hiddenFromTime" name="from">
      <input type="hidden" id="hiddenToTime" name="to">
      
      <!-- Updated purpose field -->
      <div class="form-group">
        <label for="purpose">Purpose (Optional)</label>
        <textarea id="purpose" name="purpose" rows="3" placeholder="Brief description of the purpose..."></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="closeForm('booking')">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-check-circle"></i> Submit Booking
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Booking Details Modal -->
<div id="bookingDetailsPopup" class="popup" style="display: none;">
  <div class="popup-content">
    <div class="popup-header">
      <h3>Booking Details</h3>
      <button type="button" class="close-btn" onclick="closeForm('details')">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="booking-details-content">
      <div class="detail-section">
        <h4>Basic Information</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Booking ID:</label>
            <span id="detail-id">-</span>
          </div>
          <div class="detail-item">
            <label>Status:</label>
            <span id="detail-status">-</span>
          </div>
          <div class="detail-item">
            <label>Facility:</label>
            <span id="detail-facility">-</span>
          </div>
          <div class="detail-item">
            <label>Date:</label>
            <span id="detail-date">-</span>
          </div>
          <div class="detail-item">
            <label>Time:</label>
            <span id="detail-time">-</span>
          </div>
          <div class="detail-item">
            <label>Booked On:</label>
            <span id="detail-created">-</span>
          </div>
        </div>
      </div>
      
      <div class="detail-section">
        <h4>Purpose</h4>
        <p id="detail-purpose">-</p>
      </div>
      
      <div class="detail-section" id="manager-comment-section" style="display: none;">
        <h4>Manager Comment</h4>
        <p id="detail-manager-comment">-</p>
      </div>
      
      <div class="detail-section" id="cancellation-section" style="display: none;">
        <h4>Cancellation Information</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Reason:</label>
            <span id="detail-cancellation-reason">-</span>
          </div>
          <div class="detail-item">
            <label>Cancelled By:</label>
            <span id="detail-cancelled-by">-</span>
          </div>
          <div class="detail-item">
            <label>Cancelled At:</label>
            <span id="detail-cancelled-at">-</span>
          </div>
        </div>
      </div>
      
      <div class="detail-section" id="feedback-section" style="display: none;">
        <h4>Feedback</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Rating:</label>
            <span id="detail-rating">-</span>
          </div>
          <div class="detail-item">
            <label>Comments:</label>
            <span id="detail-feedback">-</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="popup-actions">
      <button type="button" class="btn btn-secondary" onclick="closeForm('details')">
        Close
      </button>
    </div>
  </div>
</div>
</div>

<script src="../../js/resident/CSB.js"></script>
<script src="../../js/sidebar.js"></script>
</body>
</html>